---
import { getCollection } from 'astro:content';
import Layout from '@layouts/Layout.astro';
import Header from '@components/Header.astro';
import Footer from '@components/Footer.astro';
import LinkButton from '@components/LinkButton.astro';
import Hr from '@components/Hr.astro';
import Card from '@components/Card';
import Socials from '@components/Socials.astro';
import getSortedPosts from '@utils/getSortedPosts';
import { SOCIALS } from '@config';
import { publishedPostFilter } from '@utils/postFilter';

const posts = await getCollection('blog');
const publishedPosts = posts.filter(publishedPostFilter);

const sortedPosts = await getSortedPosts(posts);
// const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);

const socialCount = SOCIALS.filter(social => social.active).length;

const totalPostsCount = publishedPosts.length;
---

<Layout>
  <Header />
  <main id="main-content">
    <section id="hero">
      <h1>Aman Mittal <span class="username">@amanhimself</span></h1>
      <a
        target="_blank"
        href="/rss.xml"
        class="rss-link"
        aria-label="rss feed"
        title="RSS Feed"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="rss-icon"
          ><path
            d="M19 20.001C19 11.729 12.271 5 4 5v2c7.168 0 13 5.832 13 13.001h2z"
          ></path><path
            d="M12 20.001h2C14 14.486 9.514 10 4 10v2c4.411 0 8 3.589 8 8.001z"
          ></path><circle cx="6" cy="18" r="2"></circle>
        </svg>
        <span class="sr-only">RSS Feed</span>
      </a>
      <div class="text-lg">
        <p class="flex">
          I'm currently working on documentation as a consultant at Expo.
          <p>
            I love crafting documentation and writing about programming. I've
            been writing about cross-platform mobile and web development since
            2017, with over 150 articles for 30+ publications.
          </p>
          <p>
            Previously, worked as Developer Advocate at Draftbit, and Senior
            Content Developer at Vercel.
          </p>
          <p>
            See what I'm up to on my <a
              href="/now"
              class="text-violet-500 underline">"/now"</a
            > page or learn more about me on my <a
              href="/about"
              class="text-violet-500 underline">"/about"</a
            > page.
          </p>
        </p>
        {
          // only display if at least one social link is enabled
          socialCount > 0 && (
            <div class="social-wrapper">
              <div class="social-links">Social Links:</div>
              <Socials />
            </div>
          )
        }
      </div>

      <Hr />

      <!-- {
        featuredPosts.length > 0 && (
          <>
            <section id="featured">
              <h2>Featured</h2>
              <ul>
                {featuredPosts.map(({ data, slug }) => (
                  <Card
                    href={`/blog/${slug}/`}
                    frontmatter={data}
                    secHeading={false}
                  />
                ))}
              </ul>
            </section>
            {recentPosts.length > 0 && <Hr />}
          </>
        )
      } -->

      {
        recentPosts.length > 0 && (
          <section id="recent-posts">
            <h2>Recent Posts</h2>
            <ul>
              {recentPosts.map(
                ({ data, slug }, index) =>
                  index < 15 && (
                    <Card
                      href={`/blog/${slug}/`}
                      frontmatter={data}
                      secHeading={false}
                    />
                  )
              )}
            </ul>
          </section>
        )
      }

      <div class="all-posts-btn-wrapper">
        <LinkButton href="/blog/">
          See All {totalPostsCount} Posts
          <svg xmlns="http://www.w3.org/2000/svg"
            ><path
              d="m11.293 17.293 1.414 1.414L19.414 12l-6.707-6.707-1.414 1.414L15.586 11H6v2h9.586z"
            ></path>
          </svg>
        </LinkButton>
      </div>

      <Hr />

      <section id="projects">
        <h2>Projects</h2>
        <a href="/projects/" class="projects-card">
          <img src="/lasttimei-icon.png" alt="Last Time I App" class="project-icon" />
          <span class="projects-link-text">View all projects</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="arrow-icon"
            ><path
              d="m11.293 17.293 1.414 1.414L19.414 12l-6.707-6.707-1.414 1.414L15.586 11H6v2h9.586z"
            ></path>
          </svg>
        </a>
      </section>
    </section>

    <Footer />
  </main>

  <style>
    /* ===== Hero Section ===== */
    #hero {
      @apply pb-6 pt-8;
    }
    #hero h1 {
      @apply my-4 inline-block text-3xl font-bold sm:my-8 sm:text-4xl;
    }
    #hero .rss-link {
      @apply mb-6;
    }
    #hero .rss-icon {
      @apply mb-2 h-6 w-6 scale-110 fill-current text-[#ee802f] sm:mb-3 sm:scale-125;
    }
    #hero p {
      @apply my-2;
    }
    .username {
      background-color: #7950f2; /* Purple background */
      color: #ffffff; /* White text */
      padding: 5px 10px;
      display: inline-block;
      font-weight: bold;
      border-radius: 5px;
    }
    .social-wrapper {
      @apply mt-4 flex flex-col sm:flex-row sm:items-center;
    }
    .social-links {
      @apply mb-1 mr-2 whitespace-nowrap sm:mb-0;
    }

    /* ===== Featured & Recent Posts Sections ===== */
    #featured,
    #recent-posts {
      @apply pb-6 pt-12;
    }
    #featured h2,
    #recent-posts h2 {
      @apply text-2xl font-semibold tracking-wide;
    }
    .all-posts-btn-wrapper {
      @apply my-8 text-center;
    }

    /* ===== Projects Section ===== */
    #projects {
      @apply pb-6 pt-12;
    }
    #projects h2 {
      @apply text-2xl font-semibold tracking-wide;
    }
    .projects-card {
      @apply mt-4 flex items-center gap-4 rounded-lg border border-skin-line bg-skin-card p-4 no-underline transition-all hover:border-skin-accent;
    }
    .project-icon {
      @apply h-12 w-12 rounded-xl;
    }
    .projects-link-text {
      @apply flex-1 font-medium text-skin-accent;
    }
    .arrow-icon {
      @apply h-6 w-6 fill-skin-accent;
    }
  </style>
</Layout>
